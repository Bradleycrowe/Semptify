<!-- templates/perspective_widget.html -->
<!-- Reusable 4-Perspective Analysis Widget -->
<div class="perspective-analysis-container">
    <div class="perspective-header">
        <h3>üìä Case Analysis: 4 Perspectives</h3>
        <div class="win-probability">
            <span class="probability-label">Win Probability:</span>
            <span class="probability-value" data-probability="{{ win_probability }}">
                {{ win_probability }}%
            </span>
        </div>
    </div>

    <div class="perspectives-grid">
        <!-- Tenant Perspective -->
        <div class="perspective-card tenant">
            <div class="perspective-icon">üè†</div>
            <h4>Tenant View</h4>
            <div class="perspective-content">
                <p>{{ tenant_perspective.summary }}</p>
                <ul class="strengths">
                    {% for strength in tenant_perspective.strengths %}
                    <li>‚úì {{ strength }}</li>
                    {% endfor %}
                </ul>
                <ul class="concerns">
                    {% for concern in tenant_perspective.concerns %}
                    <li>‚ö† {{ concern }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Landlord Perspective -->
        <div class="perspective-card landlord">
            <div class="perspective-icon">üè¢</div>
            <h4>Landlord View</h4>
            <div class="perspective-content">
                <p>{{ landlord_perspective.summary }}</p>
                <ul class="strengths">
                    {% for strength in landlord_perspective.strengths %}
                    <li>‚úì {{ strength }}</li>
                    {% endfor %}
                </ul>
                <ul class="concerns">
                    {% for concern in landlord_perspective.concerns %}
                    <li>‚ö† {{ concern }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Legal Perspective -->
        <div class="perspective-card legal">
            <div class="perspective-icon">‚öñÔ∏è</div>
            <h4>Legal Analysis</h4>
            <div class="perspective-content">
                <p>{{ legal_perspective.summary }}</p>
                <ul class="statutes">
                    {% for statute in legal_perspective.relevant_statutes %}
                    <li>üìú {{ statute }}</li>
                    {% endfor %}
                </ul>
                <ul class="precedents">
                    {% for precedent in legal_perspective.precedents %}
                    <li>üìö {{ precedent }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>

        <!-- Judge Perspective -->
        <div class="perspective-card judge">
            <div class="perspective-icon">üë®‚Äç‚öñÔ∏è</div>
            <h4>Judicial View</h4>
            <div class="perspective-content">
                <p>{{ judge_perspective.summary }}</p>
                <ul class="findings">
                    {% for finding in judge_perspective.likely_findings %}
                    <li>‚Ä¢ {{ finding }}</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>

    <!-- Settlement Recommendations -->
    {% if settlement_recommendations %}
    <div class="settlement-section">
        <h4>üí° Settlement Recommendations</h4>
        <ul class="recommendations">
            {% for rec in settlement_recommendations %}
            <li>{{ rec }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <!-- Next Steps -->
    <div class="next-steps">
        <h4>üéØ Recommended Next Steps</h4>
        <ol>
            {% for step in next_steps %}
            <li>{{ step }}</li>
            {% endfor %}
        </ol>
    </div>
</div>

<style>
.perspective-analysis-container {
    background: #f8f9fa;
    border-radius: 8px;
    padding: 20px;
    margin: 20px 0;
}

.perspective-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 2px solid #dee2e6;
    padding-bottom: 15px;
}

.win-probability {
    font-size: 1.5em;
    font-weight: bold;
}

.probability-value {
    color: #28a745;
}

.probability-value[data-probability^="3"],
.probability-value[data-probability^="2"],
.probability-value[data-probability^="1"] {
    color: #dc3545;
}

.probability-value[data-probability^="5"],
.probability-value[data-probability^="6"] {
    color: #ffc107;
}

.perspectives-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 20px;
}

.perspective-card {
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.perspective-card.tenant { border-left: 4px solid #007bff; }
.perspective-card.landlord { border-left: 4px solid #6c757d; }
.perspective-card.legal { border-left: 4px solid #17a2b8; }
.perspective-card.judge { border-left: 4px solid #28a745; }

.perspective-icon {
    font-size: 2em;
    margin-bottom: 10px;
}

.perspective-card h4 {
    margin: 10px 0;
    color: #333;
}

.perspective-content ul {
    list-style: none;
    padding-left: 0;
}

.perspective-content li {
    margin: 8px 0;
    padding-left: 20px;
}

.strengths li { color: #28a745; }
.concerns li { color: #dc3545; }

.settlement-section, .next-steps {
    background: white;
    border-radius: 8px;
    padding: 15px;
    margin-top: 20px;
}

.recommendations, .next-steps ol {
    margin: 10px 0;
}

.recommendations li, .next-steps li {
    margin: 8px 0;
}
</style>

<script>
// Load perspective data dynamically
async function loadPerspectives(userId, docId) {
    try {
        const response = await fetch(/api/context//document//perspectives);
        const data = await response.json();
        
        if (data.perspectives) {
            // Update UI with perspective data
            updatePerspectiveUI(data);
        }
    } catch (error) {
        console.error('Failed to load perspectives:', error);
    }
}

function updatePerspectiveUI(data) {
    // Update win probability
    const probElem = document.querySelector('.probability-value');
    if (probElem && data.win_probability) {
        probElem.textContent = data.win_probability + '%';
        probElem.dataset.probability = data.win_probability;
    }
    
    // Update perspective content
    // (Implementation would populate each perspective card with API data)
}
</script>
