<!doctype html>

<html lang="en">

  <head>

    <meta charset="utf-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>{% block title %}Semptify{% endblock %}</title>

  <link rel="stylesheet" href="/static/css/app.css" />
  <link rel="icon" type="image/x-icon" href="/static/icons/favicon.ico" />
    {% block head_extra %}{% endblock %}
    <style>
      /* Simplified header and sidebar styling */
  .top-bar { display:flex; align-items:center; gap:1rem; }
      .nav-container { display:flex; gap:1.25rem; align-items:flex-end; }
      .office-link {
        font-size:0.92rem;
        color:#444;
        font-weight:500;
        position:absolute;
        right:0;
        bottom:0;
        margin-right:0.5rem;
        margin-bottom:0.15rem;
        background:rgba(255,255,255,0.85);
        border-radius:4px;
        padding:2px 10px;
        box-shadow:0 2px 8px rgba(0,0,0,0.04);
        z-index:100;

        position:sticky;
        top:12px; /* stick to top under header */
        max-height:calc(100vh - 140px);
        overflow-y:auto;
        text-align:center;
        font-size:0.92rem; /* slightly smaller */
      }
      .right-sidebar h5 { text-align:center; margin-bottom:1rem; }
      .right-sidebar ul { margin:0 auto; display:block; text-align:center; padding-left:0; }
      .right-sidebar ul li { list-style:none; margin:0.25rem 0; }
      .right-sidebar ul li a { display:block; text-align:center; padding:0.35rem 0; }


      :root { --header-height: 180px; }

      /* main logo: fill top bar height */
      .logo-img-large {
        height:180px;
        width:180px;
        max-width:180px;
        max-height:180px;
        display:block;
        margin:0;
        padding:0;
        object-fit:cover;
        border-radius:24px;
        background:#fff;
        box-shadow:0 2px 12px rgba(0,0,0,0.08);
      }
      .logo-container {
        display:flex;
        align-items:center;
        justify-content:flex-start;
        height:var(--header-height);
        min-width:180px;
        margin:0;
        padding:0 8px;
        z-index:1001;
        background:transparent;
      }
      .logo-container.right {
        justify-content:flex-end;
      }
      /* fixed header: pins to top, content scrolls underneath */
      .top-bar {
        height: var(--header-height);
        align-items:center;
        position:fixed;
        left:0;
        right:0;
        top:0;
        z-index:1000;
        background:#f8f9fa;
        box-shadow:0 2px 6px rgba(0,0,0,0.06);
      }
      /* small right-top logo */
      .logo-img-small { height:28px; width:auto; margin-left:12px; }

      /* sticky bottom-right note */
      .bottom-right-note {
        position:fixed;
        right:16px;
        bottom:16px;
        background:rgba(0,0,0,0.78);
        color:#fff;
        padding:8px 12px;
        border-radius:6px;
        font-size:0.85rem;
        z-index:1100;
        box-shadow:0 6px 18px rgba(0,0,0,0.12);
      }

      @media (max-width: 991px) {
        .right-sidebar { position:static; max-height:none; overflow:visible; border-left:none; }
      }

      /* main content area should scroll; header is fixed */
      .main-content {
        padding-top: calc(var(--header-height) + 16px); /* leave space for header */
        height: calc(100vh - var(--header-height));
        overflow-y: auto;
      }

      /* content module show/hide animation */
      .page-container {
        transition: transform 280ms ease, opacity 280ms ease, max-height 280ms ease;
        transform-origin: top center;
      }
      .page-container.hidden {
        transform: translateY(-8px) scaleY(0.98);
        opacity: 0;
        max-height: 0;
        overflow: hidden;
        pointer-events: none;
      }
    </style>

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" />
  <link rel="stylesheet" href="/static/css/app.css" />

  </head>

  <body class="d-flex flex-column min-vh-100">

    <!-- Header -->

  <header class="bg-light mb-4">
      <div class="container-fluid">
  <div class="top-bar d-flex align-items-center justify-content-between">
  <div class="logo-container">
      <a href="/" class="d-flex align-items-center text-decoration-none">
        <img src="/static/icons/Semptfylogo.svg" alt="Semptify Logo" class="logo-img-large">
      </a>
    </div>

    <div class="nav-container nav-row flex-grow-1 align-items-center nav-center">
      <nav class="d-flex site-nav nav-gap">
        <a href="/" class="site-nav-link">Home</a>
        <a href="/library" class="site-nav-link">Library</a>
        <a href="/office" class="site-nav-link office-link">Office</a>
        <a href="/tools" class="site-nav-link">Tools</a>
        <a href="/help" class="site-nav-link">Help</a>
      </nav>
    </div>

    {% if not current_user %}
    <div class="signin-box signin-container d-flex flex-column flex-md-row align-items-center gap-2 ms-auto">
      <a href="/register" class="btn btn-outline-primary btn-sm btn-signup order-1 order-md-0">Sign Up</a>
  <button class="content-toggle-btn btn btn-sm btn-secondary ms-2" title="Toggle content module">Toggle Module</button>
      <button id="mobile-right-toggle" class="btn btn-sm btn-outline-secondary ms-2 d-md-none" aria-label="Open sidebar">â˜°</button>
      <a href="/login" class="btn btn-outline-secondary btn-sm btn-signin order-0 order-md-1">Sign In</a>
    </div>
    {% else %}
    <div class="signin-box d-flex align-items-center gap-2">
      <div>Signed in</div>
  <button class="content-toggle-btn btn btn-sm btn-secondary ms-2" title="Toggle content module">Toggle Module</button>
      <a href="/vault?user_token={{ user_token }}" class="btn btn-sm btn-outline-primary mt-2">My Vault</a>
      <a href="#" onclick="document.cookie='user_token=; Max-Age=0; path=/'; location.href='/'" class="btn btn-link btn-sm mt-2">Sign out</a>
    </div>
    {% endif %}

  <div class="logo-container right">
      <a href="/" class="d-flex align-items-center text-decoration-none">
        <img src="/static/icons/Semptfylogo.svg" alt="Semptify Logo" class="logo-img-large">
      </a>
    </div>
    <div class="right-overlay" id="right-overlay"></div>
  </div>
        </div>
      </div>
    </header>

    <div class="container-fluid flex-grow-1 main-content">
      <div class="row">
        <!-- Left Sidebar: control panel (Part 2) -->
        <aside class="col-12 col-md-3 py-4">
          {% block left_sidebar %}
          <div id="control-panel" class="mb-3">
            <div class="card">
              <div class="card-body">
                <h6 class="card-title">Preview Controls</h6>
                <label class="form-label">Page Title</label>
                <input id="ctrl-title" class="form-control mb-2" placeholder="Preview title" />
                <label class="form-label">Page Body (HTML allowed)</label>
                <textarea id="ctrl-body" class="form-control mb-2" rows="6" placeholder="Paste HTML or text here..."></textarea>
                <div class="d-flex gap-2">
                  <button id="ctrl-apply" class="btn btn-primary btn-sm">Apply</button>
                  <button id="ctrl-reset" class="btn btn-outline-secondary btn-sm">Reset</button>
                </div>
              </div>
            </div>
          </div>
          {% endblock %}
        </aside>

        <!-- Main Content -->
        <main class="col-12 col-md-6 py-4">
          <div class="page-container">
            <!-- Content module: input -> process -> output -->
            <div id="content-module" class="mb-3">
              <div class="card">
                <div class="card-body">
                  <div class="mb-2 d-flex justify-content-between align-items-center">
                    <strong>Content Module</strong>
                    <small class="text-muted" id="module-status">idle</small>
                  </div>
                  <textarea id="module-input" class="form-control mb-2" rows="4" placeholder="Paste content or type input here..."></textarea>
                  <div class="d-flex gap-2">
                    <button id="module-run" class="btn btn-primary">Process</button>
                    <button id="module-clear" class="btn btn-outline-secondary">Clear</button>
                  </div>
                  <hr />
                  <div>
                    <label class="form-label">Output</label>
                    <pre id="module-output" class="p-2 bg-light module-output"></pre>
                  </div>
                </div>
              </div>
            </div>
            <header class="page-title">
              {% block page_title %}{% endblock %}
            </header>
            <div class="page-body">
              {% block content %}{% endblock %}
            </div>
          </div>
        </main>

        <!-- Right Sidebar: Helpful Links (Part 1) -->
        <aside class="col-12 col-md-3 py-4">
          <div class="right-sidebar">
            <h5>Helpful Links</h5>
            <ul class="list-unstyled">
              <li><a href="/office" class="link-secondary">Office</a></li>
              <li><a href="https://www.hud.gov/topics/rental_assistance" target="_blank" rel="noopener">HUD Rental Assistance</a></li>
              <li><a href="https://www.justice.gov/crt/fair-housing" target="_blank" rel="noopener">DOJ Fair Housing</a></li>
              <li><a href="https://mncourts.gov/getforms/housing-landlord-tenant" target="_blank" rel="noopener">MN Court Help (Landlord-Tenant Forms)</a></li>
            </ul>
          </div>
        </aside>
      </div>

      {% block page_footer %}{% endblock %}
    </div>

    <!-- Footer -->

    <footer class="bg-dark text-white py-3 mt-auto">

      <div class="container text-center">

        &copy; {{ year or '2025' }} Semptify. All rights reserved.
  <div class="spacer-8"></div>
        <small class="d-block mt-2">Disclaimer: Semptify provides information and tools for tenants, but does not offer legal advice. For legal matters, consult a qualified attorney.</small>
        <div id="footer-extra" class="d-none text-start small mt-2 text-muted">
          <p class="mb-1">This site helps tenants locate resources, generate documents, and prepare evidence. It is not a substitute for legal counsel.</p>
          <p class="mb-0">Use at your own discretion. For urgent legal matters consult a licensed attorney in your jurisdiction.</p>
        </div>
        <div class="mt-2">
          <button id="footer-toggle" class="btn btn-link btn-sm text-white">More</button>
        </div>

      </div>

    </footer>

     <!-- sticky small note removed as requested -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>

  {% block scripts %}{% endblock %}

        const text = inputEl.value || '';
        setStatus('processing');
        outputEl.textContent = 'Processing...';
        try {
          const resp = await fetch('/api/ai/orchestrate', {
            method: 'POST', headers: {'Content-Type':'application/json'},
            body: JSON.stringify({ requester: 'local-ui', input_refs: [], ais: [{name:'local', role:'assistant'}], strategy:'synthesize', approval_required:false })
          });
          if(resp.ok) {
            const data = await resp.json();
            outputEl.textContent = 'Job queued: ' + (data.job_id || JSON.stringify(data));
            setStatus('queued');
          } else {
            // fallback to echo
            outputEl.textContent = 'Server error, echoing input:\n\n' + text;
            setStatus('errored');
          }
        } catch(e) {
          outputEl.textContent = 'Fallback (no server) - echo:\n\n' + text;
          setStatus('fallback');
        }
      });
    })();
  </script>

  </body>

</html>
