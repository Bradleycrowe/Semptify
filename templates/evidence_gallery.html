{% extends "shell.html" %}

{% block title %}Evidence Gallery ‚Ä¢ Semptify{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title">Evidence Gallery</h1>
  <p class="page-subtitle">Browse, organize, and manage all captured evidence</p>
</div>

<!-- Filters & Controls -->
<div class="card mb-4">
  <div class="card-body">
    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: var(--space-md); margin-bottom: var(--space-md);">
      <div class="form-group">
        <label for="filter-type">Evidence Type</label>
        <select id="filter-type">
          <option value="">All Types</option>
          <option value="photo">Photos</option>
          <option value="video">Videos</option>
          <option value="audio">Audio</option>
          <option value="document">Documents</option>
          <option value="communication">Communications</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="filter-date">Date Range</label>
        <select id="filter-date">
          <option value="">All Time</option>
          <option value="today">Today</option>
          <option value="week">This Week</option>
          <option value="month">This Month</option>
          <option value="year">This Year</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="filter-tag">Tags</label>
        <select id="filter-tag">
          <option value="">All Tags</option>
          <option value="important">Important</option>
          <option value="verified">Verified</option>
          <option value="pending">Pending Review</option>
          <option value="court-ready">Court Ready</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="search-evidence">Search</label>
        <input type="text" id="search-evidence" placeholder="Search by name, location, description...">
      </div>
    </div>
    
    <div style="display: flex; gap: var(--space-md); flex-wrap: wrap; justify-content: space-between; align-items: center;">
      <div>
        <button class="btn btn-sm" onclick="applyFilters()">Apply Filters</button>
        <button class="btn btn-outline btn-sm" onclick="clearFilters()">Clear All</button>
      </div>
      
      <div style="display: flex; gap: var(--space-md);">
        <select id="view-mode">
          <option value="grid">Grid View</option>
          <option value="list">List View</option>
          <option value="timeline">Timeline View</option>
        </select>
        <select id="sort-by">
          <option value="newest">Newest First</option>
          <option value="oldest">Oldest First</option>
          <option value="name">Name (A-Z)</option>
          <option value="size">Size (Large)</option>
        </select>
      </div>
    </div>
  </div>
</div>

<!-- Stats Bar -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: var(--space-md); margin-bottom: var(--space-lg);">
  <div style="background: var(--primary-light); padding: var(--space-md); border-radius: var(--radius-md); text-align: center;">
    <div style="font-size: 2rem; font-weight: bold; color: var(--primary);" id="total-evidence">0</div>
    <div style="color: var(--gray-600); font-size: 0.9rem;">Total Items</div>
  </div>
  <div style="background: #dcf0ff; padding: var(--space-md); border-radius: var(--radius-md); text-align: center;">
    <div style="font-size: 2rem; font-weight: bold; color: #0078d7;" id="total-size">0 MB</div>
    <div style="color: var(--gray-600); font-size: 0.9rem;">Storage Used</div>
  </div>
  <div style="background: var(--success-light); padding: var(--space-md); border-radius: var(--radius-md); text-align: center;">
    <div style="font-size: 2rem; font-weight: bold; color: var(--success);" id="verified-count">0</div>
    <div style="color: var(--gray-600); font-size: 0.9rem;">Verified</div>
  </div>
  <div style="background: var(--warning-light); padding: var(--space-md); border-radius: var(--radius-md); text-align: center;">
    <div style="font-size: 2rem; font-weight: bold; color: var(--accent);" id="pending-count">0</div>
    <div style="color: var(--gray-600); font-size: 0.9rem;">Pending Review</div>
  </div>
</div>

<!-- Gallery Grid -->
<div id="evidence-container" class="cards-grid" style="margin-bottom: var(--space-2xl);">
  <!-- Evidence items will be populated here -->
  <div style="grid-column: 1 / -1; text-align: center; padding: var(--space-2xl); color: var(--gray-600);">
    <div style="font-size: 3rem; margin-bottom: var(--space-md);">üìÅ</div>
    <p>No evidence items yet. <a href="/witness_form">Create a new evidence entry</a> to get started.</p>
  </div>
</div>

<!-- Modal for Evidence Details -->
<div id="evidence-modal" class="modal">
  <div class="modal-content" style="max-width: 800px;">
    <div class="modal-header">
      <h2 class="modal-title" id="modal-title">Evidence Details</h2>
      <button class="modal-close" onclick="closeEvidenceModal()">‚úï</button>
    </div>
    <div class="modal-body">
      <div id="modal-content"></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-outline" onclick="closeEvidenceModal()">Close</button>
      <button class="btn btn-primary" onclick="addToCourtPacket()">Add to Court Packet</button>
    </div>
  </div>
</div>

<script>
// Sample evidence data (will be replaced with API call)
const evidenceData = [
  {
    id: 1,
    name: 'Lease Agreement',
    type: 'document',
    icon: 'üìÑ',
    date: '2025-11-03',
    size: 2.4,
    verified: true,
    tags: ['important', 'verified'],
    thumbnail: '/static/icons/document.svg',
    description: 'Original lease agreement for apartment',
    location: 'Apartment, 123 Main St',
    hash: 'abc123def456',
  },
  {
    id: 2,
    name: 'Maintenance Issue Video',
    type: 'video',
    icon: 'üé•',
    date: '2025-11-01',
    size: 45.3,
    verified: true,
    tags: ['verified', 'court-ready'],
    thumbnail: '/static/icons/video.svg',
    description: 'Video of broken window and water damage',
    location: 'Apartment, 123 Main St',
    hash: 'xyz789uvw012',
  },
  {
    id: 3,
    name: 'Text Messages',
    type: 'communication',
    icon: 'üí¨',
    date: '2025-10-28',
    size: 0.5,
    verified: false,
    tags: ['pending'],
    thumbnail: '/static/icons/message.svg',
    description: 'SMS conversation with landlord about repairs',
    location: 'Mobile device',
    hash: 'rst345mno678',
  },
];

// Initialize
document.addEventListener('DOMContentLoaded', function() {
  renderEvidence(evidenceData);
  updateStats(evidenceData);
});

function renderEvidence(items) {
  const container = document.getElementById('evidence-container');
  
  if (items.length === 0) {
    container.innerHTML = '<div style="grid-column: 1 / -1; text-align: center; padding: var(--space-2xl); color: var(--gray-600);"><div style="font-size: 3rem; margin-bottom: var(--space-md);">üìÅ</div><p>No evidence items found. Try adjusting your filters.</p></div>';
    return;
  }
  
  container.innerHTML = items.map(item => `
    <div class="card" style="cursor: pointer; transition: all var(--transition-fast);" onclick="openEvidenceModal('${item.id}')">
      <div style="background: var(--gray-100); height: 200px; display: flex; align-items: center; justify-content: center; font-size: 3rem;">
        ${item.icon}
      </div>
      <div class="card-body">
        <h3 style="margin: 0 0 var(--space-sm) 0; font-size: 1rem;">${item.name}</h3>
        <p style="margin: 0 0 var(--space-md) 0; color: var(--gray-600); font-size: 0.9rem;">
          ${item.date} ‚Ä¢ ${item.size} MB
        </p>
        <div style="display: flex; gap: var(--space-sm); flex-wrap: wrap; margin-bottom: var(--space-md);">
          ${item.tags.map(tag => `
            <span class="badge badge-${tag === 'important' ? 'primary' : tag === 'verified' ? 'success' : tag === 'pending' ? 'warning' : 'info'}">
              ${tag}
            </span>
          `).join('')}
        </div>
        <div style="display: flex; gap: var(--space-sm);">
          ${item.verified ? '<span style="color: var(--success); font-size: 0.9rem;">‚úì Verified</span>' : '<span style="color: var(--warning); font-size: 0.9rem;">‚óâ Pending</span>'}
        </div>
      </div>
    </div>
  `).join('');
}

function updateStats(items) {
  document.getElementById('total-evidence').textContent = items.length;
  document.getElementById('total-size').textContent = (items.reduce((sum, i) => sum + i.size, 0)).toFixed(1) + ' MB';
  document.getElementById('verified-count').textContent = items.filter(i => i.verified).length;
  document.getElementById('pending-count').textContent = items.filter(i => !i.verified).length;
}

function openEvidenceModal(id) {
  const item = evidenceData.find(e => e.id == id);
  if (!item) return;
  
  document.getElementById('modal-title').textContent = item.name;
  document.getElementById('modal-content').innerHTML = `
    <div style="margin-bottom: var(--space-lg);">
      <div style="background: var(--gray-100); height: 300px; display: flex; align-items: center; justify-content: center; font-size: 5rem; border-radius: var(--radius-md); margin-bottom: var(--space-lg);">
        ${item.icon}
      </div>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: var(--space-lg);">
        <div>
          <h4>Details</h4>
          <ul style="list-style: none; padding: 0;">
            <li style="margin-bottom: var(--space-sm);"><strong>Type:</strong> ${item.type}</li>
            <li style="margin-bottom: var(--space-sm);"><strong>Date:</strong> ${item.date}</li>
            <li style="margin-bottom: var(--space-sm);"><strong>Size:</strong> ${item.size} MB</li>
            <li style="margin-bottom: var(--space-sm);"><strong>Location:</strong> ${item.location}</li>
            <li style="margin-bottom: var(--space-sm);"><strong>Hash (SHA256):</strong> <code style="font-size: 0.8rem; word-break: break-all;">${item.hash}</code></li>
            <li style="margin-bottom: var(--space-sm);"><strong>Status:</strong> ${item.verified ? '<span style="color: var(--success);">‚úì Verified</span>' : '<span style="color: var(--warning);">Pending Review</span>'}</li>
          </ul>
        </div>
        
        <div>
          <h4>Description</h4>
          <p>${item.description}</p>
          
          <h4 style="margin-top: var(--space-lg);">Tags</h4>
          <div style="display: flex; gap: var(--space-sm); flex-wrap: wrap;">
            ${item.tags.map(tag => `
              <span class="badge badge-${tag === 'important' ? 'primary' : tag === 'verified' ? 'success' : tag === 'pending' ? 'warning' : 'info'}">
                ${tag}
              </span>
            `).join('')}
          </div>
        </div>
      </div>
    </div>
    
    <div class="alert alert-info">
      <strong>Legal Note:</strong> All evidence is timestamped and verified with SHA256 hashing for legal admissibility.
    </div>
  `;
  
  document.getElementById('evidence-modal').classList.add('active');
}

function closeEvidenceModal() {
  document.getElementById('evidence-modal').classList.remove('active');
}

function addToCourtPacket() {
  alert('Evidence added to court packet. Go to Court Packet Builder to review.');
  closeEvidenceModal();
}

function applyFilters() {
  // TODO: Implement filter logic
  alert('Filters will be applied here. This connects to the backend API.');
}

function clearFilters() {
  document.getElementById('filter-type').value = '';
  document.getElementById('filter-date').value = '';
  document.getElementById('filter-tag').value = '';
  document.getElementById('search-evidence').value = '';
  renderEvidence(evidenceData);
}

// Close modal when clicking outside
document.addEventListener('click', function(event) {
  const modal = document.getElementById('evidence-modal');
  if (event.target === modal) {
    closeEvidenceModal();
  }
});
</script>

<style>
  @media (max-width: 768px) {
    div[style*="grid-template-columns: 1fr 1fr 1fr 1fr"] {
      grid-template-columns: 1fr 1fr !important;
    }
  }
  
  @media (max-width: 480px) {
    div[style*="grid-template-columns: 1fr 1fr 1fr 1fr"] {
      grid-template-columns: 1fr !important;
    }
  }
</style>
{% endblock %}
