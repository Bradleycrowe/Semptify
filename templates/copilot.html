<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Semptify Copilot</title>
    <link rel="stylesheet" href="/static/css/app.css" />
    <style>
      .copilot { max-width: 780px; margin: 2rem auto; padding: 1rem; background: #fff; border-radius: 8px; }
      textarea { width: 100%; min-height: 140px; }
      pre { white-space: pre-wrap; background: #f6f8fa; padding: 12px; border-radius: 6px; }
      .muted { color: #666; font-size: 0.9em; }
    </style>
  </head>
  <body>
    {% include '_nav.html' %}
    <div class="copilot">
      <h1>Front House AI — Research & Drafting</h1>
      {% if provider in ['none',''] %}
        <p class="muted">AI provider is not configured. Set AI_PROVIDER and related environment variables on the server to enable responses.</p>
      {% else %}
        <p class="muted">Provider: {{ provider }}</p>
      {% endif %}

      <p class="muted">This AI helps with: housing programs search, housing law guidance, landlord/property lookups, and drafting documents. If configured to a cloud provider (e.g., Groq via OpenAI-compatible API), prompts and responses are processed off-device.</p>

      <form id="copilot-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <label for="prompt">Ask anything related to housing research, law, or drafting:</label>
        <textarea id="prompt" name="prompt" placeholder="e.g. Help me draft a service animal request letter..."></textarea>
        <label><input type="checkbox" id="citations" name="citations"> Request citations and links to sources</label>
        <button type="submit">Ask Copilot</button>
      </form>

      <h3>Answer</h3>
      <pre id="answer" class="muted">No answer yet.</pre>
      <p class="muted">Privacy note: When using a cloud provider, your prompt and the model’s response are sent to that provider. For fully local processing, set AI_PROVIDER=ollama.</p>
    </div>
    <script>
      const form = document.getElementById('copilot-form');
      const answer = document.getElementById('answer');
      form.addEventListener('submit', async (e) => {
        e.preventDefault();
        const prompt = document.getElementById('prompt').value.trim();
        const csrf = form.querySelector('input[name="csrf_token"]').value;
        if(!prompt){ answer.textContent = 'Please enter a prompt.'; return; }
        answer.textContent = 'Thinking...';
        try {
          const citations = document.getElementById('citations').checked;
          const r = await fetch('/api/copilot', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json', 'X-CSRF-Token': csrf },
            body: JSON.stringify({ prompt, citations })
          });
          const data = await r.json();
          if(!r.ok){
            answer.textContent = `Error (${r.status}): ${data && data.error ? data.error : 'Unknown error'}`;
          } else {
            answer.textContent = data.output || '(empty)';
          }
        } catch(err){
          answer.textContent = 'Network error: ' + err;
        }
      });
    </script>
    {% include '_footer.html' %}
  </body>
  <script src="/static/js/help-panel.js"></script>
</html>
