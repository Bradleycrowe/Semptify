<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  <title>Semptify Admin</title>
  <link rel="stylesheet" href="/static/css/admin.css" />
  </head>
  <body>
    <h1>Semptify Admin</h1>
    {% if security_mode == 'open' %}
      <div class="banner banner-open">SECURITY MODE: OPEN (no admin token enforcement). Do not use in production.</div>
    {% else %}
      <div class="banner banner-enforced">SECURITY MODE: ENFORCED</div>
      {% if token_ids %}
        <p><strong>Active Token IDs:</strong> {{ token_ids|join(', ') }}</p>
        <p><small>Break-glass requires file <code>security/breakglass.flag</code> + a breakglass token.</small></p>
        <form action="/rotate_token" method="post" class="rotate-form">
          <fieldset>
            <legend>Rotate Token</legend>
            <label>Token ID: <input name="target_id" placeholder="primary" required></label>
            <label>New Value: <input name="new_value" required></label>
            <input type="hidden" name="token" value="{{ admin_token }}">
            <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
            <button type="submit" onclick="return confirm('Rotate this token now?');">Rotate</button>
          </fieldset>
        </form>
      {% endif %}
    {% endif %}
    <p><a href="{{ ci_url }}" target="_blank">View CI dashboard</a></p>
    <p><a href="{{ pages_url }}" target="_blank">View Pages site</a></p>

    <form action="/release_now" method="post" onsubmit="return confirmRelease(this);">
      <input type="hidden" name="token" value="{{ admin_token }}">
      <input type="hidden" name="confirm_release" value="yes">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <button type="submit">Release Now</button>
    </form>

    <form action="/trigger_workflow" method="post" onsubmit="return confirmTrigger(this);">
      <input type="hidden" name="token" value="{{ admin_token }}">
      <input type="hidden" name="confirm_trigger" value="yes">
      <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
      <label>Workflow file: <input name="workflow" value="ci.yml"></label>
      <label>ref: <input name="ref" value="main"></label>
      <button type="submit">Trigger CI</button>
    </form>

  <p><a href="/release_history?token={{ admin_token }}">View Release History</a></p>
  <p><a href="/sbom?token={{ admin_token }}">View SBOMs</a></p>

  <hr>
  <h2>Developer Utilities</h2>
  <form action="/admin/run_tests" method="post" onsubmit="return confirm('Run the full test suite now?');">
    <input type="hidden" name="token" value="{{ admin_token }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <button type="submit">Run Tests</button>
  </form>
  <p class="muted">Tip: For local dev, run <code>scripts/dev_server.ps1</code> to start with sensible defaults.</p>

  <hr>
  <h2>Help Panel Settings</h2>
  <form action="/admin/help_panel_save" method="post">
    <input type="hidden" name="token" value="{{ admin_token }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}">
    <p>
      <label><input type="checkbox" name="enabled" checked> Enabled</label>
    </p>
    <p>
  <label>Button Label <input name="label" value="R" maxlength="2"></label>
    </p>
    <p>
      <label>Position
        <select name="position">
          <option value="br" selected>Bottom Right</option>
          <option value="bl">Bottom Left</option>
        </select>
      </label>
    </p>
    <p>
      <label>Default Read (fallback)<br>
        <textarea name="read_default" rows="2" placeholder="Fallback Read content shown if no page meta provided."></textarea>
      </label>
    </p>
    <p>
      <label>Default Instructions (fallback)<br>
        <textarea name="instructions_default" rows="2" placeholder="Fallback Instructions content."></textarea>
      </label>
    </p>
    <button type="submit">Save Help Panel Settings</button>
  </form>
  <script>
    function confirmRelease(form){
      return confirm('Confirm creating a release tag now?');
    }
    function confirmTrigger(form){
      return confirm('Trigger the specified workflow now?');
    }
  </script>
  </body>
</html>
