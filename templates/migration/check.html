<!DOCTYPE html>
<html>
<head>
    <title>Migrate Your Data - Semptify</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; max-width: 800px; margin: 50px auto; padding: 20px; }
        .warning { background: #fff3cd; border-left: 4px solid #ffc107; padding: 20px; margin: 20px 0; }
        .info { background: #d1ecf1; border-left: 4px solid #17a2b8; padding: 20px; margin: 20px 0; }
        .button { background: #007bff; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; }
        .button:hover { background: #0056b3; }
        .secondary { background: #6c757d; }
        .secondary:hover { background: #545b62; }
        .result { background: #d4edda; border-left: 4px solid #28a745; padding: 20px; margin: 20px 0; display: none; }
        .error { background: #f8d7da; border-left: 4px solid #dc3545; }
    </style>
</head>
<body>
    <h1>�� Migrate Your Data</h1>
    
    {% if file_count > 0 %}
    <div class="warning">
        <h2>⚠️ Action Required</h2>
        <p><strong>You have {{ file_count }} file(s) in our old storage system.</strong></p>
        <p>We're transitioning to user-owned storage (Google Drive or Dropbox). Your data needs to be migrated to your own storage to ensure you maintain access.</p>
    </div>
    
    {% if has_storage %}
    <div class="info">
        <h3>✓ Storage Connected</h3>
        <p>You're ready to migrate! Click below to transfer your files to your storage.</p>
    </div>
    
    <button class="button" onclick="executeMigration()">Migrate My Files Now</button>
    
    <div id="result" class="result">
        <h3>Migration Complete!</h3>
        <p id="resultText"></p>
    </div>
    
    <div id="error" class="result error" style="display:none;">
        <h3>Migration Error</h3>
        <p id="errorText"></p>
    </div>
    
    <script>
        function executeMigration() {
            document.querySelector('.button').disabled = true;
            document.querySelector('.button').textContent = 'Migrating...';
            
            fetch('/api/migrate/execute', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
                body: 'user_token={{ user_token }}'
            })
            .then(r => r.json())
            .then(data => {
                if (data.error) {
                    document.getElementById('errorText').textContent = data.error;
                    document.getElementById('error').style.display = 'block';
                } else {
                    document.getElementById('resultText').textContent = 
                        Successfully migrated  of  files to ;
                    document.getElementById('result').style.display = 'block';
                }
            })
            .catch(err => {
                document.getElementById('errorText').textContent = err.message;
                document.getElementById('error').style.display = 'block';
            });
        }
    </script>
    
    {% else %}
    <div class="info">
        <h3>→ Setup Storage First</h3>
        <p>Before migrating, you need to connect Google Drive or Dropbox.</p>
    </div>
    
    <a href="/setup"><button class="button">Setup Storage</button></a>
    <p style="color: #666; margin-top: 10px;">After setup, return here to migrate your files.</p>
    {% endif %}
    
    {% else %}
    <div class="info">
        <h3>✓ No Migration Needed</h3>
        <p>You don't have any files in our old storage system.</p>
    </div>
    <a href="/vault?user_token={{ user_token }}"><button class="secondary button">Go to Vault</button></a>
    {% endif %}
</body>
</html>
