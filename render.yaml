services:
  - type: web
    name: semptifygui
    runtime: docker
    plan: free
    region: oregon
    # Dockerfile in repo root will be used for build/run
    envVars:
      - key: SEMPTIFY_PORT
        value: 8080
      # === Copilot (Free-tier via OpenAI-compatible API) ===
      # Option A: Groq (recommended free-tier) — set AI_PROVIDER=openai and provide your GROQ API key
      - key: AI_PROVIDER
        value: openai
      # Groq uses an OpenAI-compatible Chat Completions endpoint
      - key: OPENAI_BASE_URL
        value: https://api.groq.com/openai/v1/chat/completions
      # Choose a Groq-supported model (see Groq docs). Example:
      - key: OPENAI_MODEL
        value: llama-3.1-8b-instant
      # Set this secret in Render Dashboard (do NOT commit)
      - key: OPENAI_API_KEY
        sync: false
      # Option B (alternative): OpenAI or Azure OpenAI — remove OPENAI_BASE_URL and set respective envs
      # For Azure, set AI_PROVIDER=azure and configure AZURE_OPENAI_* vars below.
      - key: AZURE_OPENAI_ENDPOINT
        sync: false
      - key: AZURE_OPENAI_API_KEY
        sync: false
      - key: AZURE_OPENAI_DEPLOYMENT
        sync: false
      - key: AZURE_OPENAI_API_VERSION
        value: "2024-02-15-preview"
      # Flask session/CSRF secret – set in Render Dashboard
      - key: FLASK_SECRET
        sync: false
      # Legacy admin token still accepted in enforced mode (transitional). Set securely in Render.
      - key: ADMIN_TOKEN
        sync: false
      # Enforce security for admin routes (requires ADMIN_TOKEN or tokens file)
      - key: SECURITY_MODE
        value: enforced
      # Force HTTPS redirects and set HSTS
      - key: FORCE_HTTPS
        value: "1"
      - key: HSTS_MAX_AGE
        value: "31536000" # 1 year
      - key: HSTS_PRELOAD
        value: "1"
      # Structured JSON access logs to logs/events.log
      - key: ACCESS_LOG_JSON
        value: "1"
      # Admin rate limiting (defaults are generous; tune as needed)
      - key: ADMIN_RATE_WINDOW
        value: "60"
      - key: ADMIN_RATE_MAX
        value: "60"
      - key: ADMIN_RATE_STATUS
        value: "429"
    autoDeploy: true
    healthCheckPath: /health
